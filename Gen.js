let divs = []
let div0, div1


var names = "MY GUY JAMES JOHN ROBERT MICHAEL WILLIAM DAVID RICHARD CHARLES JOSEPH THOMAS CHRISTOPHER DANIEL PAUL MARK DONALD GEORGE KENNETH STEVEN EDWARD BRIAN RONALD ANTHONY KEVIN JASON MATTHEW GARY TIMOTHY JOSE LARRY JEFFREY FRANK SCOTT ERIC STEPHEN ANDREW RAYMOND GREGORY JOSHUA JERRY DENNIS WALTER PATRICK PETER HAROLD DOUGLAS HENRY CARL ARTHUR RYAN ROGER JOE JUAN JACK ALBERT JONATHAN JUSTIN TERRY GERALD KEITH SAMUEL WILLIE RALPH LAWRENCE NICHOLAS ROY BENJAMIN BRUCE BRANDON ADAM HARRY FRED WAYNE BILLY STEVE LOUIS JEREMY AARON RANDY HOWARD EUGENE CARLOS RUSSELL BOBBY VICTOR MARTIN ERNEST PHILLIP TODD JESSE CRAIG ALAN SHAWN CLARENCE SEAN PHILIP CHRIS JOHNNY EARL JIMMY ANTONIO DANNY BRYAN TONY LUIS MIKE STANLEY LEONARD NATHAN DALE MANUEL RODNEY CURTIS NORMAN ALLEN MARVIN VINCENT GLENN JEFFERY TRAVIS JEFF CHAD JACOB LEE MELVIN ALFRED KYLE FRANCIS BRADLEY JESUS HERBERT FREDERICK RAY JOEL EDWIN DON EDDIE RICKY TROY RANDALL BARRY ALEXANDER BERNARD MARIO LEROY FRANCISCO MARCUS MICHEAL THEODORE CLIFFORD MIGUEL OSCAR JAY JIM TOM CALVIN ALEX JON RONNIE BILL LLOYD TOMMY LEON DEREK WARREN DARRELL JEROME FLOYD LEO ALVIN TIM WESLEY GORDON DEAN GREG JORGE DUSTIN PEDRO DERRICK DAN LEWIS ZACHARY COREY HERMAN MAURICE VERNON ROBERTO CLYDE GLEN HECTOR SHANE RICARDO SAM RICK LESTER BRENT RAMON CHARLIE TYLER GILBERT GENE MARC REGINALD RUBEN BRETT ANGEL NATHANIEL RAFAEL LESLIE EDGAR MILTON RAUL BEN CHESTER CECIL DUANE FRANKLIN ANDRE ELMER BRAD GABRIEL RON MITCHELL ROLAND ARNOLD HARVEY JARED ADRIAN KARL CORY CLAUDE ERIK DARRYL JAMIE NEIL JESSIE CHRISTIAN JAVIER FERNANDO CLINTON TED MATHEW TYRONE DARREN LONNIE LANCE CODY JULIO KELLY KURT ALLAN NELSON GUY CLAYTON HUGH MAX DWAYNE DWIGHT ARMANDO FELIX JIMMIE EVERETT JORDAN IAN WALLACE KEN BOB JAIME CASEY ALFREDO ALBERTO DAVE IVAN JOHNNIE SIDNEY BYRON JULIAN ISAAC MORRIS CLIFTON WILLARD DARYL ROSS VIRGIL ANDY MARSHALL SALVADOR PERRY KIRK SERGIO MARION TRACY SETH KENT TERRANCE RENE EDUARDO TERRENCE ENRIQUE FREDDIE WADE dave david andrew alux alex lex luthor luther lindman Vince christian devin charles charlie chap jack jeff geoff michael laen levi lenny homer bart steven robbie robert dillon joshua andrew eric vern chris daniel mark markus markis mitch bernie burnie brody ashton dave david hunter franklin fabian jared jarod richard"

var fnames = "MARY PATRICIA LINDA BARBARA ELIZABETH JENNIFER MARIA SUSAN MARGARET DOROTHY LISA NANCY KAREN BETTY HELEN SANDRA DONNA CAROL RUTH SHARON MICHELLE LAURA SARAH KIMBERLY DEBORAH JESSICA SHIRLEY CYNTHIA ANGELA MELISSA BRENDA AMY ANNA REBECCA VIRGINIA KATHLEEN PAMELA MARTHA DEBRA AMANDA STEPHANIE CAROLYN CHRISTINE MARIE JANET CATHERINE FRANCES ANN JOYCE DIANE ALICE JULIE HEATHER TERESA DORIS GLORIA EVELYN JEAN CHERYL MILDRED KATHERINE JOAN ASHLEY JUDITH ROSE JANICE KELLY NICOLE JUDY CHRISTINA KATHY THERESA BEVERLY DENISE TAMMY IRENE JANE LORI RACHEL MARILYN ANDREA KATHRYN LOUISE SARA ANNE JACQUELINE WANDA BONNIE JULIA RUBY LOIS TINA PHYLLIS NORMA PAULA DIANA ANNIE LILLIAN EMILY ROBIN PEGGY CRYSTAL GLADYS RITA DAWN CONNIE FLORENCE TRACY EDNA TIFFANY CARMEN ROSA CINDY GRACE WENDY VICTORIA EDITH KIM SHERRY SYLVIA JOSEPHINE THELMA SHANNON SHEILA ETHEL ELLEN ELAINE MARJORIE CARRIE CHARLOTTE MONICA ESTHER PAULINE EMMA JUANITA ANITA RHONDA HAZEL AMBER EVA DEBBIE APRIL LESLIE CLARA LUCILLE JAMIE JOANNE ELEANOR VALERIE DANIELLE MEGAN ALICIA SUZANNE MICHELE GAIL BERTHA DARLENE VERONICA JILL ERIN GERALDINE LAUREN CATHY JOANN LORRAINE LYNN SALLY REGINA ERICA BEATRICE DOLORES BERNICE AUDREY YVONNE ANNETTE JUNE SAMANTHA MARION DANA STACY ANA RENEE IDA VIVIAN ROBERTA HOLLY BRITTANY MELANIE LORETTA YOLANDA JEANETTE LAURIE KATIE KRISTEN VANESSA ALMA SUE ELSIE BETH JEANNE VICKI CARLA TARA ROSEMARY EILEEN TERRI GERTRUDE LUCY TONYA ELLA STACEY WILMA GINA KRISTIN JESSIE NATALIE AGNES VERA WILLIE CHARLENE BESSIE DELORES MELINDA PEARL ARLENE MAUREEN COLLEEN ALLISON TAMARA JOY GEORGIA CONSTANCE LILLIE CLAUDIA JACKIE MARCIA TANYA NELLIE MINNIE MARLENE HEIDI GLENDA LYDIA VIOLA COURTNEY MARIAN STELLA CAROLINE DORA JO VICKIE MATTIE TERRY MAXINE IRMA MABEL MARSHA MYRTLE LENA CHRISTY DEANNA PATSY HILDA GWENDOLYN JENNIE NORA MARGIE NINA CASSANDRA LEAH PENNY KAY PRISCILLA NAOMI CAROLE BRANDY OLGA BILLIE DIANNE TRACEY LEONA JENNY FELICIA SONIA MIRIAM VELMA BECKY BOBBIE VIOLET KRISTINA TONI MISTY MAE SHELLY DAISY RAMONA SHERRI ERIKA KATRINA CLAIRE LINDSEY LINDSAY GENEVA GUADALUPE BELINDA MARGARITA SHERYL CORA FAYE ADA NATASHA SABRINA ISABEL MARGUERITE HATTIE HARRIET MOLLY CECILIA KRISTI BRANDI BLANCHE SANDY ROSIE JOANNA IRIS EUNICE ANGIE INEZ LYNDA MADELINE AMELIA ALBERTA GENEVIEVE MONIQUE JODI JANIE MAGGIE KAYLA SONYA JAN LEE KRISTINE CANDACE FANNIE MARYANN OPAL ALISON YVETTE MELODY LUZ SUSIE OLIVIA FLORA SHELLEY KRISTY MAMIE LULA LOLA VERNA BEULAH ANTOINETTE CANDICE JUANA JEANNETTE PAM KELLI HANNAH WHITNEY BRIDGET KARLA CELIA LATOYA PATTY SHELIA GAYLE DELLA VICKY LYNNE SHERI MARIANNE KARA JACQUELYN ERMA BLANCA MYRA LETICIA PAT KRISTA ROXANNE ANGELICA JOHNNIE ROBYN FRANCIS ADRIENNE ROSALIE ALEXANDRA BROOKE BETHANY SADIE BERNADETTE TRACI JODY KENDRA JASMINE NICHOLE RACHAEL CHELSEA MABLE ERNESTINE MURIEL MARCELLA ELENA KRYSTAL ANGELINA NADINE KARI ESTELLE DIANNA PAULETTE LORA MONA DOREEN ROSEMARIE ANGEL DESIREE ANTONIA HOPE GINGER JANIS BETSY CHRISTIE FREDA MERCEDES MEREDITH LYNETTE TERI CRISTINA EULA LEIGH MEGHAN SOPHIA ELOISE ROCHELLE GRETCHEN CECELIA RAQUEL HENRIETTA ALYSSA JANA KELLEY GWEN KERRY JENNA TRICIA LAVERNE OLIVE ALEXIS TASHA SILVIA ELVIRA CASEY DELIA SOPHIE KATE PATTI LORENA KELLIE SONJA LILA LANA DARLA MAY MINDY ESSIE MANDY LORENE ELSA JOSEFINA JEANNIE MIRANDA DIXIE LUCIA MARTA FAITH LELA JOHANNA SHARI CAMILLE TAMI SHAWNA ELISA EBONY MELBA ORA NETTIE TABITHA OLLIE JAIME WINIFRED KRISTIE MARINA ALISHA AIMEE RENA MYRNA MARLA TAMMIE LATASHA BONITA PATRICE RONDA SHERRIE ADDIE FRANCINE DELORIS STACIE ADRIANA CHERI SHELBY ABIGAIL CELESTE JEWEL CARA ADELE REBEKAH LUCINDA DORTHY CHRIS EFFIE TRINA REBA SHAWN SALLIE AURORA LENORA ETTA LOTTIE KERRI TRISHA NIKKI ESTELLA FRANCISCA JOSIE TRACIE MARISSA KARIN BRITTNEY JANELLE LOURDES LAUREL HELENE FERN ELVA CORINNE KELSEY INA BETTIE ELISABETH AIDA CAITLIN INGRID IVA EUGENIA CHRISTA GOLDIE CASSIE MAUDE JENIFER THERESE FRANKIE DENA LORNA JANETTE LATONYA CANDY MORGAN CONSUELO TAMIKA ROSETTA DEBORA CHERIE POLLY DINA JEWELL FAY JILLIAN DOROTHEA NELL TRUDY ESPERANZA PATRICA KIMBERLEY SHANNA HELENA CAROLINA CLEO STEFANIE ROSARIO OLA JANINE MOLLIE LUPE ALISA LOU MARIBEL SUSANNE BETTE SUSANA ELISE CECILE ISABELLE LESLEY JOCELYN PAIGE JONI RACHELLE LEOLA DAPHNE ALTA ESTER PETRA GRACIELA IMOGENE JOLENE KEISHA LACEY GLENNA GABRIELA KERI URSULA LIZZIE KIRSTEN SHANA ADELINE MAYRA JAYNE JACLYN GRACIE SONDRA CARMELA MARISA ROSALIND CHARITY TONIA BEATRIZ MARISOL CLARICE JEANINE SHEENA ANGELINE FRIEDA LILY ROBBIE SHAUNA MILLIE CLAUDETTE CATHLEEN ANGELIA GABRIELLE AUTUMN KATHARINE SUMMER JODIE STACI LEA CHRISTI JIMMIE JUSTINE ELMA LUELLA MARGRET DOMINIQUE SOCORRO RENE MARTINA MARGO MAVIS CALLIE BOBBI MARITZA LUCILE LEANNE JEANNINE DEANA AILEEN LORIE LADONNA WILLA MANUELA GALE SELMA DOLLY SYBIL ABBY LARA DALE IVY DEE WINNIE MARCY LUISA JERI MAGDALENA OFELIA MEAGAN AUDRA MATILDA LEILA CORNELIA BIANCA SIMONE BETTYE RANDI VIRGIE LATISHA BARBRA GEORGINA ELIZA LEANN BRIDGETTE RHODA HALEY ADELA NOLA BERNADINE FLOSSIE ILA GRETA RUTHIE NELDA MINERVA LILLY TERRIE LETHA HILARY ESTELA VALARIE BRIANNA ROSALYN EARLINE CATALINA AVA MIA CLARISSA LIDIA CORRINE ALEXANDRIA CONCEPCION TIA SHARRON RAE DONA ERICKA JAMI ELNORA CHANDRA LENORE NEVA MARYLOU MELISA TABATHA SERENA AVIS ALLIE SOFIA JEANIE ODESSA NANNIE HARRIETT LORAINE PENELOPE MILAGROS EMILIA BENITA ALLYSON ASHLEE TANIA TOMMIE ESMERALDA KARINA EVE PEARLIE ZELMA MALINDA NOREEN TAMEKA SAUNDRA HILLARY AMIE ALTHEA ROSALINDA JORDAN LILIA ALANA GAY CLARE ALEJANDRA ELINOR MICHAEL LORRIE JERRI DARCY EARNESTINE CARMELLA TAYLOR NOEMI MARCIE LIZA ANNABELLE LOUISA EARLENE MALLORY CARLENE NITA SELENA TANISHA KATY JULIANNE JOHN LAKISHA EDWINA MARICELA MARGERY KENYA DOLLIE ROXIE ROSLYN KATHRINE NANETTE CHARMAINE LAVONNE ILENE KRIS TAMMI SUZETTE CORINE KAYE JERRY MERLE CHRYSTAL LINA DEANNE LILIAN JULIANA ALINE LUANN KASEY MARYANNE EVANGELINE COLETTE MELVA LAWANDA YESENIA NADIA MADGE KATHIE EDDIE OPHELIA VALERIA NONA MITZI MARI GEORGETTE CLAUDINE FRAN ALISSA ROSEANN LAKEISHA SUSANNA REVA DEIDRE CHASITY SHEREE CARLY JAMES ELVIA ALYCE DEIRDRE GENA BRIANA ARACELI KATELYN ROSANNE WENDI TESSA BERTA MARVA IMELDA MARIETTA MARCI LEONOR ARLINE SASHA MADELYN JANNA JULIETTE DEENA AURELIA JOSEFA AUGUSTA LILIANA YOUNG CHRISTIAN LESSIE AMALIA SAVANNAH ANASTASIA VILMA NATALIA ROSELLA LYNNETTE CORINA ALFREDA LEANNA CAREY AMPARO COLEEN TAMRA AISHA WILDA KARYN CHERRY QUEEN MAURA MAI EVANGELINA ROSANNA HALLIE ERNA ENID MARIANA LACY JULIET JACKLYN FREIDA MADELEINE MARA HESTER CATHRYN LELIA CASANDRA BRIDGETT ANGELITA JANNIE DIONNE ANNMARIE KATINA BERYL PHOEBE MILLICENT KATHERYN DIANN CARISSA MARYELLEN LIZ LAURI HELGA GILDA ADRIAN RHEA MARQUITA HOLLIE TISHA TAMERA ANGELIQUE FRANCESCA BRITNEY KAITLIN LOLITA FLORINE ROWENA REYNA TWILA FANNY JANELL INES CONCETTA BERTIE ALBA BRIGITTE ALYSON VONDA PANSY ELBA NOELLE LETITIA KITTY DEANN BRANDIE LOUELLA LETA FELECIA SHARLENE LESA BEVERLEY ROBERT ISABELLA HERMINIA TERRA CELINA "
const jobtypes = ["fighter", "utility", "none", "misc"]
const locSuffixes = ["pore","ville","berg","ton","ia","tis","den"," forest","ce","lands","hills","caster","cot","cott","dale","dean","don","den","ham","field","ing","land","ington","mouth","pool","ness","wick","wich","stead","run","shaw"]
const races = ["man","mountain dwarf","hill dwarf","High elf","wood elf","dark elf","hobbit","troll","giant","orc","goblin","kobold"]
const factionPrefixes = ["Brotherhood of ","Kingdom of ","Alliance of ","United ","Army of ","The chosen ","The great ","The ",""]
const factionSuffixes = [" conglomerate", " empire", " rebellion", " legion", " union", ""]
const jobs = {
  fighter: ["blacksmith","adventurer","guard","armorer", "archer","outlaw","mercenary"],
  utility: ["farmer","jester","shopkeep","cook","grave digger","doctor","butcher"],
  none: ["prisoner","vagrant","shepard","dancer","body collector","janitor","slave","innkeep"],
  misc: ["sourcerer","conjerour","necromancer","mage","wizard","pyromancer"]
}
//let jobs = ["blacksmith","adventurer","shopkeep","guard","vagrant","farmer","sourcerer","jester","armorer","archer","hunter","outlaw","prisoner"]


let delta = 4
let mchain = markovCreate(names)
let fchain = markovCreate(fnames)

function srandom(min = 0, max = 1, int = false) {
  res = 0
  if (Array.isArray(min)) {
    return min[Math.floor(rng.next() * min.length)]
  } else {
    res = rng.next() * (max - min) + min
    if (int == true) {
      return +(res).toFixed(0)
    } else {
      return res
    }
  }
}

function vow(str) {
  var m = str.match(/[aeiouy]/gi);
  return m === null ? 0 : m.length;
}

function prandom(seed) {
  seed = String(seed)
  hold = ''
  for (var i = 0; i < seed.length; i++) {
    hold = seed.charAt(i) + seed.charAt(i) + hold
  }
  t = ''
  for (var i = 0; i < hold.length; i++) {
    t += hold.charCodeAt(i)
  }
  hold = t
  console.log(hold, "h");
  seed = parseInt(hold)

  this._seed = seed % 2147483647;
  if (this._seed <= 0) {
    this._seed += 2147483646;
  }
};
prandom.prototype.next = function(a, b) {
  this._seed = this._seed * 16807 % 2147483647;
  if (arguments.length === 0) {
    return this._seed / 2147483647;
  } else if (arguments.length === 1) {
    return (this._seed / 2147483647) * a;
  } else {
    return (this._seed / 2147483647) * (b - a) + a;
  }
}

prandom.prototype.nextFloat = function(opt_minOrMax, opt_max) {
  // We know that result of next() will be 1 to 2147483646 (inclusive).
  return (this.next() - 1) / 2147483646;
};

function reset(sed = Date.now()) {
  rng = new prandom(sed)
  seed = sed
  for (var i = 0; i < divs.length; i++) {
    divs[0].remove()
    divs.shift()
  }
  div0.remove()
  div1.remove()
  sd.remove()
  peeps = []
  factions = []
  locations = []
  divs = []
  setup()
}

function show() {
  sd = createDiv(seed)
  info = createDiv()
  div0 = createDiv()
  div1 = createDiv()
  div0.parent(div1)
  div1.addClass('container-fluid px-0 mx-auto')
  for (var i = 0; i < 5; i++) {
    factions.push(new faction())
  }
  console.log(rng._seed)

  for (var i = 0; i < (3*10); i++) {
    locations.push(new place())
  }
  for (var i = 0; i < peeps.length; i++) {
    //createP(JSON.stringify(peeps[i]).replace(/,/g, ",<br>"))
  }
  for (var i = 0; i < locations.length; i++) {
    divs.push(createDiv(JSON.stringify(locations[i]).replace(/,/g, ",<br>")))
  }
  div0.addClass('row px-0')
  for (var i = 0; i < divs.length; i++) {
    divs[i].parent(div0)
    divs[i].style('overflow-y', 'scroll')
    divs[i].style('height', '200px')
    divs[i].addClass('col-3 border m-1')
  }
}

function Name(length = 3, se = 0,chain = mchain) {
  hold = ''
  for (var i = 0; i < length; i++) {
    hold += srandom(chain)
  }
  hold = hold.charAt(0).toUpperCase() + hold.slice(1);
  while (vow(hold.substring(0, 3)) == 0) {
    hold = Name(length, se + 1,chain)
  }
  if (vow(hold.substring(hold.length-2, hold.length-0)) == 0) {
    hold = hold.slice(0,hold.length-2) + "n"
  }
  return hold
}

function markovCreate(names) {
  names = names.toLowerCase()
  names = names.replace(/\s/g, '');
  let temp = []
  for (var i = -2; i < 2; i++) {
    let step = 0
    while (step < names.length) {
      let add = names.substring(step, step + delta + i)
      if (vow(add) >= 1 && add.length > 1) {
        temp.push(add)
      }
      step += delta + i
    }
    step = Math.round(delta / 2)
    while (step < names.length) {
      let add = names.substring(step, step + delta + i)
      if (vow(add) >= 1 && add.length > 1) {
        temp.push(add)
      }
      step += delta + i
    }

  }
  return temp
  console.log(step, temp);
}

function stats(points = 20) {
  pointstart = points
  temp = {}
  stat = [0, 0, 0, 0, 0, 0]
  while (points >= 0) {
    f = 1

    if (f >= points) {
      f = points
    }
    points -= f
    if (points == 0) {
      points-=1
    }
    stat[srandom(0, 5, true)] += 1
  }
  hold = 0
  temp.str = stat[0]
  temp.dex = stat[1]
  temp.con = stat[2]
  temp.int = stat[3]
  temp.wis = stat[4]
  temp.cha = stat[5]
  return temp
}


function relate() {
  temp = {}
  for (var i = 0; i < factions.length; i++) {
    temp[factions[i].name] = +srandom(-2, 2).toFixed(1)
  }
  return temp
}

class place {
  constructor() {
    this.name = `${Name(srandom(1,2,true),0,mchain)}${srandom(locSuffixes)}`
    this.size = (srandom(0, 2, true) == 1) ? srandom(1, 15, true) : srandom(15, 55, true)
    this.race = srandom(races)
    this.relations = relate()
    this.population = Math.round(this.size * srandom(0, 3, true))
    if (srandom(0, 10, true) == 0) {
      this.population = 0
    }
    this.people = []
    for (var i = 0; i < this.population; i++) {
      this.people.push(new character(this.race))
    }
  }
}
class faction {
  constructor() {
    this.name = (srandom(0, 1, true) == 0) ? `${srandom(factionPrefixes)}${Name(srandom(1,2,true),0,mchain)}` : `The ${Name(srandom(1,2,true),0,mchain)}${srandom(factionSuffixes)}`
  }
}

class character {
  constructor(race = srandom(races)) {
    this.age = srandom(17, 50, true) + ((srandom(0, 1, false) > 0.6) ? srandom(0, 15, true) : 0) + ((srandom(0, 1, false) > 0.7) ? srandom(0, 15, true) : 0)
    this.gender = (srandom(0,1,true)==0?"Male":"Female")
    if (this.gender == "Female") {
      this.name = `${Name((srandom(5, 6, true)) / delta,0,fchain)} ${Name((srandom(5, 6, true)) / delta,0,fchain)}`
    }else {
      this.name = `${Name((srandom(5, 6, true)) / delta,0,mchain)} ${Name((srandom(5, 6, true)) / delta,0,mchain)}`
    }
    this.race = race
    this.jobtype = srandom(jobtypes)
    this.job = srandom(jobs[this.jobtype])
    this.wealth = srandom(0, 10000, true)
    this.points = srandom((2.5*(this.age-17)), (3.5*(this.age-17)), true)
    this.stats = stats(this.points)
    //wealth modifier
    this.wealth *= ((this.stats.cha + 1) / this.points)
    this.wealth = Math.round(this.wealth)
    this.wealth *= ((this.stats.wis + 1) / (this.points / 6))
    this.wealth = Math.round(this.wealth)
    if (this.jobtype == "none") {
      this.wealth = Math.round(this.wealth / 10)
      this.points -= 5
      this.stats.int -= 5
      if (this.stats.int < 0) {
        this.points -= this.stats.int
        this.stats.int = 0
      }
    }else if (this.jobtype == "utility") {
      this.wealth = Math.round(this.wealth / 5)
    }else if (this.jobtype == "fighter") {
      this.wealth = Math.round(this.wealth / 2)
      //console.log(this.stats.str,this.stats.wis)
      this.stats.str += 5
      this.stats.wis -= 5
      if (this.stats.wis < 0) {
        this.stats.str -= this.stats.wis
        this.stats.wis = 0

      }
      //console.log(this.stats.str,this.stats.wis);
    }
    //end wealthmod
    //stat modifier

  }
}
